<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root {
        --theme-color: #ef3967;
        --theme-background: #222222;
      }
      html {
        overflow: hidden;
        height: 100vh;
        font-family: Helvetica, sans-serif;
      }
      body {
        --pad: 5px;
        margin: 0;
        height: calc(100vh - var(--pad) * 2);
        overflow: hidden;

    	background:url("https://sv1.picz.in.th/images/2020/04/29/UOUo6y.jpg") var(--theme-color);
  	background-size:cover;
  	background-blend-mode: screen;
      }
      .mobile {
        height: 100%;
        max-width: 290px;
        margin: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .hsv-detail {
        margin-top: 5px;
        width: 100%; 
        display: flex; 
        justify-content: space-between;
      }
      .hsv-detail > div {
        padding: 0rem;
        width: 20%;
        text-align: center;
        padding: 1rem;
      
        margin: 0px;
      }
      .yt-iframe_wrapper {
        position: relative;
       
        z-index: 29000;
        height: 100px; 
        overflow: hidden; 
        width: 100%
      }
      #yt-iframe {
        position: absolute;
        z-index: -1;
      }
    
      .hsv-label {
        font-size: 1.5rem;
        margin-bottom: 4px;
      }
      .pig{
        color: var(--theme-color); 
        
      }
    </style>
  </head>
  <body>
    <div class="mobile">
      <h2 class="pig">Color 2 Music</h2>
      <div class="color_picker"></div>
      <br>
      <div class='yt-iframe_wrapper'>
        <iframe id='yt-iframe' style='top: -100px;' width="290" height="290" src="https://www.youtube-nocookie.com/embed/m7MEhXTEXLs?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
      
    </div>
      

  
    <script src='https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.5.5/rxjs.umd.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@jaames/iro/dist/iro.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js'></script>
    <script>
      
      // please edit this function



      function hsv2youtubeid({ h, s, v }) {
        const musics = [
          { key: ['stri', 'fast', 'major'], val: ['I2e9a5ytKPA', 'Mp_C7o9xfIU', 'f9ZqcpMRLis'] },
          { key: ['stri', 'fast', 'minor'], val: ['PiUaMJWVFNA', 'vYZOKj0lldc', 'hjcPISVhRfI'] },
          { key: ['stri', 'medi', 'major'], val: ['d772AwpoNFs', 'vLNqzoS9xDw', 'x-SUsXdRDhs'] },
          { key: ['stri', 'medi', 'minor'], val: ['a_fY2zvgKww', 'UomR6i8ON24', 'ybIJAZQLsIs'] },
          { key: ['stri', 'slow', 'major'], val: ['tzmhyX18jx8', 'cU590KSUX3Y', 'aXJZeYaqBIA'] },
          { key: ['stri', 'slow', 'minor'], val: ['jspLEdJhA9s', 'lozoBnljUcg', 'lufH4x4gJlQ'] },

          { key: ['wood', 'fast', 'major'], val: ['eTrfc_isQAc', 'VM0aBcHYmU8', 'hVtX7RYz8-4'] },
          { key: ['wood', 'fast', 'minor'], val: ['vCNyo-tmBcA', '0pQaDb_fTrA', 'SKUAeDCWoJE'] },
          { key: ['wood', 'medi', 'major'], val: ['GcH_rm0vX5Q', 'uyRI1xtzlZk', 'b5dNg6Fh6fU'] },
          { key: ['wood', 'medi', 'minor'], val: ['uG0u-cMTz20', 'rLMT41j1K_w', 'QNLBMudWkuM'] },
          { key: ['wood', 'slow', 'major'], val: ['ZZKsQHmaPGA', 're8kA2k-JLQ', 'DEYEHAOMX8U'] },
          { key: ['wood', 'slow', 'minor'], val: ['hnQzgpz36UU', 'pzE1Q7TA6bs', 'I4sIiiEjw3w'] },

          { key: ['blas', 'fast', 'major'], val: ['gOEMlcNqT7U', 'fL6duEcjXuY', 'NMIAnUvrsXA'] },
          { key: ['blas', 'fast', 'minor'], val: ['IF1-Dap5Peg', 'prmua-qDkkU', 'onWslBz85YU'] },
          { key: ['blas', 'medi', 'major'], val: ['ac_nl-tEO6U', '0lIsXScysGQ', '-9E3C8W0uOA'] },
          { key: ['blas', 'medi', 'minor'], val: ['BxSiMMS954Y', 'pG5NUfN8JV8', 'gh3C59B1_gs'] },
          { key: ['blas', 'slow', 'major'], val: ['QLsn30kBG3c', 'lErGFs7mMgU', 'OBfL8uhYBsU'] },
          { key: ['blas', 'slow', 'minor'], val: ['xGakNk_wrv4', '_2smfaSOvtc', '5ak-LHxFvTo'] },

          { key: ['perc', 'fast', 'major'], val: ['WvEYqU2reBY', 'RpHaldD-ouc', 'Sb9GcHS1qZ0'] },
          { key: ['perc', 'fast', 'minor'], val: ['ToMT8hXZxSA', 'pk_DXqVAnWA', 'iYxEiJXE9tU'] },
          { key: ['perc', 'medi', 'major'], val: ['9E6b3swbnWg', 'qD9_tRg9dms', 'YJENQYF5J7Q'] },
          { key: ['perc', 'medi', 'minor'], val: ['j6XXMFCOgdE', 'HymSnFj8ipc', 'gwtFMxNJ3Uw'] },
          { key: ['perc', 'slow', 'major'], val: ['lcpN-cETscA', '6vjqeDCeqjk', 'LWwJWv2g9VY'] },
          { key: ['perc', 'slow', 'minor'], val: ['h_vZtpjNKVE', 'qNDHb4fbOuE', 'MM5yQOKfaQc'] },
        ];

        const h_select = {
          'stri': h >= 15  && h < 105,
          'wood': h >= 105 && h < 195,
          'blas': h >= 195 && h < 285,
          'perc': h >= 285 && h < 360 || h < 15,
        }
        const v_select = {
          'major': v >= 50,
          'minor': v <  50,
        }
        const s_select = {
          'slow': s < 33,
          'medi': s < 67 && s >= 33,
          'fast': s >= 67,
        }

        const select = [
          _.findKey(h_select, _.identity),
          _.findKey(s_select, _.identity),
          _.findKey(v_select, _.identity),
        ]

        for (const {key, val} of musics) {
          if (_.isEqual(key, select)) {
            return _.sample(val)
          }
        }
        alert(JSON.stringify({h, s, v}) + "is not found" + JSON.stringify(select))
      }

      function youtubeid2url(yid) {
        return `https://www.youtube-nocookie.com/embed/${yid}?controls=0&autoplay=1`
      }

      const { BehaviorSubject, Subject, Observable } = rxjs
      const { map, filter, scan, withLatestFrom, tap, share } = rxjs.operators

      const raw_color$ = new Observable(sub => {
        const color_picker = new iro.ColorPicker(".color_picker", {
          width: 290,
          color: '#ffffff',
          borderWidth: 2,
          borderColor: "#fff",
        });
        color_picker.on(["color:init", "color:change"], function(color){
          sub.next(color);
        })
      }).pipe(share())

      raw_color$.pipe(
        map(raw_color => raw_color.hsv),
        map(hsv2youtubeid),
        map(youtubeid2url),
      ).subscribe(url => {
        document.getElementById('yt-iframe').src = url
      })
      

      raw_color$.subscribe((raw_color) => {
        const root = document.documentElement;
      
      //////
        const contrast =  raw_color.hsl.l > 17.9 ? '#1e1e24' : '#e2e4db';
        root.style.setProperty('--theme-color', raw_color.hexString);
        root.style.setProperty('--theme-background', contrast);
      });
  
    </script>
  </body>
</html>
